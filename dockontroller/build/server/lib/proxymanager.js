// Generated by CoffeeScript 1.7.1
var PROXYPATH, ProxyManager, forever;

forever = require('forever-monitor');

PROXYPATH = '../cozy-proxy/build/server.js';

module.exports = ProxyManager = (function() {
  function ProxyManager() {}

  ProxyManager.prototype.start = function(env, callback) {
    if (this.proxy_process) {
      this.proxy_process.stop();
    }
    this.proxy_process = new forever.Monitor(PROXYPATH, {
      max: 3,
      silent: true,
      logFile: '/var/log/cozy_proxy.log',
      outFile: '/var/log/cozy_proxy_out.log',
      errFile: '/var/log/cozy_proxy_err.log',
      env: env
    });
    this.proxy_process.on('start', function() {
      callback(null);
      return callback = null;
    });
    this.proxy_process.on('exit', function() {
      if (callback) {
        return callback(new Error("PROXY CANT START"));
      } else {
        console.log("PROXY HAS FAILLED TOO MUCH");
        return setTimeout(((function(_this) {
          return function() {
            return process.exit(1);
          };
        })(this)), 1);
      }
    });
    this.proxy_process.on('error', function(err) {
      return console.log(err);
    });
    return this.proxy_process.start();
  };

  ProxyManager.prototype.stop = function() {
    this.proxy_process.stop();
    return this.proxy_process = null;
  };

  return ProxyManager;

})();
