// Generated by CoffeeScript 1.7.1
var DockerCommander, commander, log;

module.exports = function(app, server, callback) {
  var utils;
  utils = require('./middlewares/utils');
  return utils.initToken(callback);
};

DockerCommander = require('../server/lib/controller');

commander = new DockerCommander();

log = console.log.bind(console);

commander.install('cozy/couchdb', 'latest', {}, function(err) {
  if (err) {
    return log(err);
  }
  return commander.install('cozy/datasystem', 'latest', {}, function(err) {
    if (err) {
      return log(err);
    }
    return commander.startCouch(function(err) {
      if (err) {
        return log(err);
      }
      return commander.startDataSystem(function(err) {
        if (err) {
          return log(err);
        }
        return commander.install('cozy/home', 'latest', {}, function(err, home) {
          if (err) {
            return log(err);
          }
          return commander.ambassador('proxy', 9104, function(err) {
            if (err) {
              return log(err);
            }
            return commander.ambassador('controller', 9002, function(err) {
              if (err) {
                return log(err);
              }
              return commander.startHome(function(err, data, homePort) {
                if (err) {
                  return log(err);
                }
                console.log("HOME PORT", homePort);
                return commander.startProxy(homePort, function(err) {
                  if (err) {
                    return log(err);
                  }
                  return console.log("DONE");
                });
              });
            });
          });
        });
      });
    });
  });
});
